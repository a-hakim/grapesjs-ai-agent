/*! grapesjs-ai-agent - 1.0.11 */
!function(n,e){'object'==typeof exports&&'object'==typeof module?module.exports=e():'function'==typeof define&&define.amd?define([],e):'object'==typeof exports?exports["grapesjs-ai-agent"]=e():n["grapesjs-ai-agent"]=e()}(Object('undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:this),()=>(()=>{"use strict";var n={d:(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(n,e)=>Object.prototype.hasOwnProperty.call(n,e),r:n=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(n,'__esModule',{value:!0})}},e={};n.r(e),n.d(e,{default:()=>u});const t=`\n  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n    <g><path d="M6 6h12a2.25 2.25 0 012.25 2.25v7.5A2.25 2.25 0 0118 18h-6l-4 3 0-3H6a2.25 2.25 0 01-2.25-2.25v-7.5A2.25 2.25 0 016 6zM12 3v3M9 3h6M8.25 12a.75.75 0 110-1.5.75.75 0 010 1.5zM15.75 12a.75.75 0 110-1.5.75.75 0 010 1.5zM9 15h6"></path></g>\n  </svg>\n`,o=function(n){let e=arguments.length>2?arguments[2]:void 0;const o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).classPrefix||'gaia',s=`${o}-fab-position`,i=5;let a=null,r=!1,l=!1,d=0,c=0,p=0,g=0;const u=()=>{try{const n=sessionStorage.getItem(s);return n?JSON.parse(n):null}catch(n){return null}},m=n=>{0===n.button&&(n.preventDefault(),f(n.clientX,n.clientY),document.addEventListener('mousemove',b),document.addEventListener('mouseup',v))},h=n=>{if(1!==n.touches.length)return;n.preventDefault();const e=n.touches[0];f(e.clientX,e.clientY),document.addEventListener('touchmove',y,{passive:!1}),document.addEventListener('touchend',w),document.addEventListener('touchcancel',w)},f=(n,e)=>{r=!0,l=!1,p=n,g=e;const t=a.getBoundingClientRect();d=n-t.left,c=e-t.top},b=n=>{r&&(n.preventDefault(),x(n.clientX,n.clientY))},y=n=>{r&&1===n.touches.length&&(n.preventDefault(),x(n.touches[0].clientX,n.touches[0].clientY))},x=(t,s)=>{if(!l){const r=t-p,d=s-g;if(Math.sqrt(r*r+d*d)<i)return;l=!0,a.classList.add(`${o}-dragging`),(()=>{const e=n.Canvas?.getElement(),t=n.Canvas?.getFrameEl();e&&(e.style.pointerEvents='none'),t&&(t.style.pointerEvents='none')})(),e.isOpen&&e.togglePanel()}let r=t-d,u=s-c;const m=a.offsetWidth,h=a.offsetHeight;r=Math.max(0,Math.min(r,window.innerWidth-m)),u=Math.max(0,Math.min(u,window.innerHeight-h)),a.style.left=`${r}px`,a.style.top=`${u}px`,a.style.right='auto',a.style.bottom='auto'},v=()=>{document.removeEventListener('mousemove',b),document.removeEventListener('mouseup',v),$()},w=()=>{document.removeEventListener('touchmove',y),document.removeEventListener('touchend',w),document.removeEventListener('touchcancel',w),$()},$=()=>{r&&(r=!1,a.classList.remove(`${o}-dragging`),(()=>{const e=n.Canvas?.getElement(),t=n.Canvas?.getFrameEl();e&&(e.style.pointerEvents=''),t&&(t.style.pointerEvents='')})(),l?(()=>{try{const n=a.getBoundingClientRect();sessionStorage.setItem(s,JSON.stringify({x:n.left,y:n.top}))}catch(n){}})():e.togglePanel(),l=!1)};return(()=>{a=document.createElement('button'),a.className=`${o}-fab`,a.innerHTML=t,a.setAttribute('title','AI Assistant'),a.setAttribute('aria-label','Open AI Assistant');const e=u();e&&(a.style.left=`${e.x}px`,a.style.top=`${e.y}px`,a.style.right='auto',a.style.bottom='auto'),a.addEventListener('mousedown',m),a.addEventListener('touchstart',h,{passive:!1});const s=n.getContainer();s?(s.style.position='relative',s.appendChild(a)):document.body.appendChild(a)})(),{getFAB:()=>a,getPosition:()=>{if(!a)return{x:0,y:0};const n=a.getBoundingClientRect();return{x:n.left,y:n.top}},destroy:()=>{a&&(a.removeEventListener('mousedown',m),a.removeEventListener('touchstart',h),a.remove(),a=null)}}},s=`\n  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n  </svg>\n`,i=`\n  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n  </svg>\n`,a=`\n  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n  </svg>\n`,r=`\n  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n    <g><path d="M6 6h12a2.25 2.25 0 012.25 2.25v7.5A2.25 2.25 0 0118 18h-6l-4 3 0-3H6a2.25 2.25 0 01-2.25-2.25v-7.5A2.25 2.25 0 016 6zM12 3v3M9 3h6M8.25 12a.75.75 0 110-1.5.75.75 0 010 1.5zM15.75 12a.75.75 0 110-1.5.75.75 0 010 1.5zM9 15h6"></path></g>\n  </svg>\n`,l=function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;const d=e.classPrefix||'gaia';let c=null,p=null,g=null,u=null,m=null;const h=()=>{u.style.height='auto',u.style.height=Math.min(u.scrollHeight,100)+'px'},f=n=>{'Enter'!==n.key||n.shiftKey||(n.preventDefault(),b())},b=async()=>{const n=u.value.trim();let e=[...t.pendingComponents];if(0===e.length&&t.lastUsedComponents.length>0&&(e=[...t.lastUsedComponents]),!n&&0===e.length)return;e.length>0&&(t.lastUsedComponents=[...e]);const o={role:'user',content:n,components:e.length>0?e:void 0};t.history.push(o),u.value='',h(),t.pendingComponents=[],w(),x(),y(!0);try{const o=await l.sendMessage(n,e,t.history),s={role:'assistant',content:o.reply||'I have processed your request.'};t.history.push(s),o.modifications&&l.applyModifications(o.modifications),x()}catch(n){console.error('API Error:',n);const e={role:'assistant',content:`Error: ${n.message||'Failed to process request. Please try again.'}`,isError:!0};t.history.push(e),x()}finally{y(!1)}},y=n=>{if(t.isLoading=n,m.disabled=n,u.disabled=n,n){const n=document.createElement('div');n.className=`${d}-loading`,n.id=`${d}-loading-indicator`,n.innerHTML=`\n        <div class="${d}-loading-dots">\n          <div class="${d}-loading-dot"></div>\n          <div class="${d}-loading-dot"></div>\n          <div class="${d}-loading-dot"></div>\n        </div>\n      `,p.appendChild(n),M()}else{const n=document.getElementById(`${d}-loading-indicator`);n&&n.remove()}},x=()=>{p&&(p.innerHTML='',0!==t.history.length?(t.history.forEach(n=>{const e=document.createElement('div');e.className=`${d}-message ${d}-message-${n.role}`,n.isError&&e.classList.add(`${d}-error`);let t=k(n.content);if(n.components&&n.components.length>0){t=n.components.map(n=>`<span class="${d}-message-badge">[component: ${k(n)}]</span>`).join('')+'<br>'+t}e.innerHTML=t,p.appendChild(e)}),M()):v())},v=()=>{if(t.history.length>0)return;const n=document.createElement('div');n.className=`${d}-empty`,n.innerHTML=`\n      ${r}\n      <p>${e.emptyMessage||"Hello! Select components and describe what changes you'd like me to make."}</p>\n    `,p.appendChild(n)},w=()=>{g&&(g.innerHTML='',t.pendingComponents.forEach(n=>{const e=document.createElement('div');e.className=`${d}-badge`,e.innerHTML=`\n        <span>[component: ${k(n)}]</span>\n        <button class="${d}-badge-remove" data-id="${k(n)}" aria-label="Remove">${a}</button>\n      `;e.querySelector(`.${d}-badge-remove`).addEventListener('click',()=>{$(n)}),g.appendChild(e)}))},$=n=>{const e=t.pendingComponents.indexOf(n);e>-1&&(t.pendingComponents.splice(e,1),w())},M=()=>{p&&(p.scrollTop=p.scrollHeight)},k=n=>{if(!n)return'';const e=document.createElement('div');return e.textContent=n,e.innerHTML};return(()=>{c=document.createElement('div'),c.className=`${d}-panel`,c.innerHTML=`\n      <div class="${d}-header">\n        <h3 class="${d}-header-title">${e.chatTitle||'AI Assistant'}</h3>\n        <button class="${d}-close-btn" aria-label="Close">${s}</button>\n      </div>\n      <div class="${d}-messages"></div>\n      <div class="${d}-badges"></div>\n      <div class="${d}-input-area">\n        <textarea class="${d}-input" placeholder="${e.inputPlaceholder||'Type your message...'}" rows="1"></textarea>\n        <button class="${d}-submit-btn" aria-label="Submit">${i}</button>\n      </div>\n    `,p=c.querySelector(`.${d}-messages`),g=c.querySelector(`.${d}-badges`),u=c.querySelector(`.${d}-input`),m=c.querySelector(`.${d}-submit-btn`);c.querySelector(`.${d}-close-btn`).addEventListener('click',()=>t.togglePanel()),m.addEventListener('click',b),u.addEventListener('keydown',f),u.addEventListener('input',h);const o=n.getContainer();o?o.appendChild(c):document.body.appendChild(c),x()})(),{getPanel:()=>c,openPanel:()=>{c&&((()=>{if(!c||!o)return;const n=o.getFAB();if(!n)return;const t=n.getBoundingClientRect(),s=e.panelWidth||360,i=e.panelHeight||480,a=10,r=t.left,l=t.top,d=t.right,p=t.bottom,g=(t.width,l+t.height/2);let u,m;const h=window.innerWidth-d;u=r>=s+a?r-s-a:h>=s+a?d+a:Math.max(a,(window.innerWidth-s)/2);const f=l,b=window.innerHeight-p;f>=i+a?m=l-i-a:b>=i+a?m=p+a:(m=Math.max(a,g-i/2),m=Math.min(m,window.innerHeight-i-a)),c.style.position='fixed',c.style.right='auto',c.style.bottom='auto',c.style.left=`${u}px`,c.style.top=`${m}px`})(),c.classList.add(`${d}-open`),u.focus())},closePanel:()=>{c&&c.classList.remove(`${d}-open`)},addComponentBadge:n=>{t.pendingComponents.includes(n)||(t.pendingComponents.push(n),w())},removeComponentBadge:$,renderMessages:x,renderBadges:w,destroy:()=>{c&&(c.remove(),c=null)}}},d=`\n  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n    <g><path d="M6 6h12a2.25 2.25 0 012.25 2.25v7.5A2.25 2.25 0 0118 18h-6l-4 3 0-3H6a2.25 2.25 0 01-2.25-2.25v-7.5A2.25 2.25 0 016 6zM12 3v3M9 3h6M8.25 12a.75.75 0 110-1.5.75.75 0 010 1.5zM15.75 12a.75.75 0 110-1.5.75.75 0 010 1.5zM9 15h6"></path></g>\n  </svg>\n`,c=function(n){let e=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;const o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).classPrefix||'gaia',s=`${o}:add-to-chat`,i=`${o}-send-to-chat`,a=n=>{if(!n)return;const e=n.get('toolbar')||[];if(e.some(n=>n.id===i))return;const t=[...e,{id:i,command:s,attributes:{class:`${o}-toolbar-btn`,title:'Send to AI Chat'},label:d}];n.set('toolbar',t)};return n.Commands.add(s,{run(n){const o=n.getSelected();if(o){const n=o.cid||o.getId();t&&(t.addComponentBadge(n),e.isOpen||e.togglePanel())}}}),n.on('component:selected',n=>{a(n)}),n.on('component:toggled',n=>{n&&a(n)}),{addToolbarButton:a,commandId:s,toolbarBtnId:i}},p={'grapesjs-ai-agent':{chatTitle:'AI Assistant',inputPlaceholder:'Type your message...',submitButton:'Submit',closeButton:'Close',toolbarButton:'Send to AI Chat',loading:'Thinking...',emptyMessage:"Hello! Select components and describe what changes you'd like me to make.",errorNetwork:'Network error. Please check your connection and try again.',errorApi:'API error. Please try again.',errorNoApi:'API endpoint not configured.',errorNotFound:'Component not found.',successUpdate:'Successfully updated the component.',successMultiUpdate:'Successfully updated {count} component(s).',componentBadge:'[component: {id}]',removeBadge:'Remove component'}},g={api:'',headers:{},fabPosition:{x:null,y:null},panelWidth:360,panelHeight:480,classPrefix:'gaia',chatTitle:'AI Assistant',inputPlaceholder:'Type your message...',emptyMessage:"Hello! Select components and describe what changes you'd like me to make.",i18n:{}},u=function(n){const e={...g,...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}};e.api||console.warn('grapesjs-ai-agent: "api" option is required but not provided. The plugin will load but API calls will fail.');const t={history:[],pendingComponents:[],lastUsedComponents:[],isOpen:!1,isLoading:!1,togglePanel:null};let s=null,i=null,a=null,r=null;const d=()=>{!function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=e.classPrefix||'gaia',o=`\n    /* ========================================\n       Floating Action Button (FAB)\n       ======================================== */\n    .${t}-fab {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 56px;\n      height: 56px;\n      border-radius: 50%;\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      z-index: 15;\n      outline: none;\n    }\n\n    .${t}-fab:hover {\n      transform: scale(1.1);\n    }\n\n    .${t}-fab:active {\n      transform: scale(0.95);\n    }\n\n    .${t}-fab.${t}-dragging {\n      cursor: grabbing;\n      transition: none;\n    }\n\n    .${t}-fab svg {\n      width: 32px;\n      height: 32px;\n      stroke: white;\n    }\n\n    /* ========================================\n       Chatbot Panel\n       ======================================== */\n    .${t}-panel {\n      position: fixed;\n      bottom: 90px;\n      right: 20px;\n      width: ${e.panelWidth||360}px;\n      height: ${e.panelHeight||480}px;\n      background: #09090B;\n      border-radius: 16px;\n      display: flex;\n      flex-direction: column;\n      z-index: 15;\n      overflow: hidden;\n      opacity: 0;\n      transform: translateY(20px) scale(0.95);\n      pointer-events: none;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .${t}-panel.${t}-open {\n      opacity: 1;\n      transform: translateY(0) scale(1);\n      pointer-events: auto;\n    }\n\n    /* Header */\n    .${t}-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 8px 8px 8px 16px;\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\n      color: white;\n    }\n\n    .${t}-header-title {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 16px;\n      font-weight: 600;\n      margin: 0;\n    }\n\n    .${t}-close-btn {\n      background: rgba(255, 255, 255, 0.2);\n      border: none;\n      width: 28px;\n      height: 28px;\n      border-radius: 50%;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s;\n    }\n\n    .${t}-close-btn:hover {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .${t}-close-btn svg {\n      width: 14px;\n      height: 14px;\n      fill: white;\n    }\n\n    /* Messages Area */\n    .${t}-messages {\n      flex: 1;\n      overflow-y: auto;\n      padding: 12px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n\n    .${t}-messages::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .${t}-messages::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    .${t}-messages::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 3px;\n    }\n\n    /* Message Bubbles */\n    .${t}-message {\n      max-width: 85%;\n      padding: 12px 16px;\n      border-radius: 16px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      line-height: 1.5;\n      word-wrap: break-word;\n    }\n\n    .${t}-message-assistant {\n      align-self: flex-start;\n      background: #ffffff1a;\n      color: #e0e0e0;\n      border-bottom-left-radius: 4px;\n    }\n\n    .${t}-message-user {\n      align-self: flex-end;\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\n      color: white;\n      border-bottom-right-radius: 4px;\n    }\n\n    /* Component Badges in Messages */\n    .${t}-message-badge {\n      display: inline-block;\n      background: rgba(255, 255, 255, 0.2);\n      padding: 2px 8px;\n      border-radius: 12px;\n      font-size: 12px;\n      margin: 2px 4px 2px 0;\n      font-family: 'Monaco', 'Menlo', monospace;\n    }\n\n    /* Loading Indicator */\n    .${t}-loading {\n      align-self: flex-start;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 12px 16px;\n      background: #ffffff1a;\n      border-radius: 16px;\n      border-bottom-left-radius: 4px;\n    }\n\n    .${t}-loading-dots {\n      display: flex;\n      gap: 4px;\n    }\n\n    .${t}-loading-dot {\n      width: 8px;\n      height: 8px;\n      background: #007370;\n      border-radius: 50%;\n      animation: ${t}-bounce 1.4s infinite ease-in-out;\n    }\n\n    .${t}-loading-dot:nth-child(1) { animation-delay: -0.32s; }\n    .${t}-loading-dot:nth-child(2) { animation-delay: -0.16s; }\n    .${t}-loading-dot:nth-child(3) { animation-delay: 0s; }\n\n    @keyframes ${t}-bounce {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n    }\n\n    /* Badge Area */\n    .${t}-badges {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n      padding: 8px 12px;\n      background: #18181B;\n      min-height: 36px;\n      border-top: 1px solid #ffffff1a;\n    }\n\n    .${t}-badges:empty {\n      display: none;\n    }\n\n    .${t}-badge {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\n      color: white;\n      padding: 4px 10px;\n      border-radius: 8px;\n      font-family: 'Monaco', 'Menlo', monospace;\n      font-size: 11px;\n    }\n\n    .${t}-badge-remove {\n      background: rgba(255, 255, 255, 0.3);\n      border: none;\n      width: 16px;\n      height: 16px;\n      border-radius: 50%;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      transition: background 0.2s;\n    }\n\n    .${t}-badge-remove:hover {\n      background: rgba(255, 255, 255, 0.5);\n    }\n\n    .${t}-badge-remove svg {\n      width: 8px;\n      height: 8px;\n      fill: white;\n    }\n\n    /* Input Area */\n    .${t}-input-area {\n      display: flex;\n      gap: 8px;\n      padding: 12px 12px;\n      background: #18181B;\n      border-top: 1px solid #ffffff1a;\n    }\n\n    .${t}-input {\n      flex: 1;\n      background: #ffffff1a;\n      border: 1px solid #3d3d5c;\n      border-radius: 8px;\n      padding: 10px 16px;\n      color: #e0e0e0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      outline: none;\n      transition: border-color 0.2s;\n      resize: none;\n      min-height: 40px;\n      max-height: 100px;\n    }\n\n    .${t}-input:focus {\n      border-color: #007370;\n    }\n\n    .${t}-input::placeholder {\n      color: #a3a3a3;\n    }\n\n    .${t}-submit-btn {\n      width: 40px;\n      height: 40px;\n      min-width: 40px;\n      border-radius: 50%;\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s;\n    }\n\n    .${t}-submit-btn:hover {\n      transform: scale(1.05);\n    }\n\n    .${t}-submit-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n      transform: none;\n    }\n\n    .${t}-submit-btn svg {\n      width: 18px;\n      height: 18px;\n      fill: white;\n    }\n\n    /* Error Message */\n    .${t}-error {\n      background: #ff4757;\n      color: white;\n      padding: 8px 12px;\n      border-radius: 8px;\n      font-size: 13px;\n      margin: 8px 16px;\n    }\n\n    /* Empty State */\n    .${t}-empty {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      color: #a3a3a3;\n      text-align: center;\n      padding: 20px;\n    }\n\n    .${t}-empty svg {\n      width: 64px;\n      height: 64px;\n      margin-bottom: 16px;\n    }\n\n    .${t}-empty p {\n      margin: 0;\n      font-size: 14px;\n      line-height: 1.5;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n\n    /* Toolbar Button */\n    .${t}-toolbar-btn {\n      display: inline-block;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .${t}-toolbar-btn svg {\n      width: 16px;\n      height: 16px;\n      fill: none;\n    }\n  `,s=document.getElementById(`${t}-styles`);s&&s.remove(),(()=>{const n=document.createElement('style');n.id=`${t}-styles`,n.textContent=o,document.head.appendChild(n)})()}(n,e),a=function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=e.api||'',o=e.headers||{},s=e=>{const t=n.getWrapper();if(!t)return null;const o=n=>{for(const t of n.models||[]){if(t.cid===e||t.getId()===e)return t;const n=o(t.components());if(n)return n}return null};return t.cid===e||t.getId()===e?t:o(t.components())};return{sendMessage:async function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t)throw new Error('API endpoint not configured. Please set the "api" option.');const a={};e.forEach(n=>{const e=s(n);e&&(a[n]=e.toHTML())});const r={history:i.map(n=>({role:n.role,content:n.content,components:n.components||[]})),message:n,components:e,componentData:a};try{const n=await fetch(t,{method:'POST',headers:{'Content-Type':'application/json',Accept:'application/json',...o},body:JSON.stringify(r)});if(!n.ok){const e=await n.text();throw new Error(`API error (${n.status}): ${e||'Unknown error'}`)}return await n.json()}catch(n){if('TypeError'===n.name&&n.message.includes('fetch'))throw new Error('Network error. Please check your connection and try again.');throw n}},findComponentById:s,applyModifications:e=>{const t={success:[],failed:[]};return Object.entries(e).forEach(n=>{let[e,o]=n;try{const n=s(e);if(!n)return console.warn(`Component with ID "${e}" not found`),void t.failed.push({id:e,error:'Component not found'});n.get('type');const i=n.getAttributes();if(n.getClasses(),n.components().reset(),o.trim()){const e=document.createElement('div');e.innerHTML=o.trim();const t=e.firstElementChild;if(t&&1===e.children.length&&t.tagName.toLowerCase()===n.get('tagName')?.toLowerCase()){const e={};Array.from(t.attributes).forEach(n=>{'id'!==n.name&&(e[n.name]=n.value)}),n.setAttributes({...i,...e,id:i.id}),n.components(t.innerHTML)}else n.components(o)}n.view&&n.view.render();try{n.trigger('change')}catch(n){console.warn(`Post-update event error for component "${e}":`,n)}t.success.push({id:e,component:n}),console.log(`Successfully updated component "${e}"`)}catch(n){console.error(`Failed to update component "${e}":`,n),t.failed.push({id:e,error:n.message})}}),t.success.length>0&&console.log(`Updated ${t.success.length} component(s)`),t.failed.length>0&&console.warn(`Failed to update ${t.failed.length} component(s)`),n.refresh(),t},getComponentHtml:n=>{const e=s(n);return e?e.toHTML():null}}}(n,e),t.togglePanel=()=>{t.isOpen=!t.isOpen,t.isOpen?i?.openPanel():i?.closePanel()},s=o(n,e,t),i=l(n,e,t,s,a),r=c(n,e,t,i)};n.on('load',()=>{d(),n.I18n&&n.I18n.addMessages({en:p,...e.i18n})}),n.on('destroy',()=>{s?.destroy(),i?.destroy()}),n.AiAgent={open:()=>{t.isOpen||t.togglePanel()},close:()=>{t.isOpen&&t.togglePanel()},toggle:()=>{t.togglePanel()},show:()=>{const n=s?.getFAB();n&&(n.style.display='');const t=document.getElementById(`${e.classPrefix||'gaia'}-hidden-toolbar`);t&&t.remove()},hide:()=>{t.isOpen&&t.togglePanel();const n=s?.getFAB();n&&(n.style.display='none');const o=e.classPrefix||'gaia',i=`${o}-hidden-toolbar`;if(!document.getElementById(i)){const n=document.createElement('style');n.id=i,n.textContent=`\n          .${o}-toolbar-btn {\n            display: none !important;\n          }\n        `,document.head.appendChild(n)}},addComponent:n=>{i?.addComponentBadge(n)},removeComponent:n=>{i?.removeComponentBadge(n)},getHistory:()=>[...t.history],clearHistory:()=>{t.history=[],i?.renderMessages()},getPendingComponents:()=>[...t.pendingComponents],isOpen:()=>t.isOpen,api:()=>a}};return e})());
//# sourceMappingURL=index.js.map