{"version":3,"file":"index.js","mappings":"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","sources":["webpack://grapesjs-ai-agent/webpack/universalModuleDefinition","webpack://grapesjs-ai-agent/webpack/bootstrap","webpack://grapesjs-ai-agent/webpack/runtime/define property getters","webpack://grapesjs-ai-agent/webpack/runtime/hasOwnProperty shorthand","webpack://grapesjs-ai-agent/webpack/runtime/make namespace object","webpack://grapesjs-ai-agent/./src/styles.js","webpack://grapesjs-ai-agent/./src/fab.js","webpack://grapesjs-ai-agent/./src/chatbot.js","webpack://grapesjs-ai-agent/./src/toolbar.js","webpack://grapesjs-ai-agent/./src/locale/en.js","webpack://grapesjs-ai-agent/./src/index.js","webpack://grapesjs-ai-agent/./src/api.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"grapesjs-ai-agent\"] = factory();\n\telse\n\t\troot[\"grapesjs-ai-agent\"] = factory();\n})(Object(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : this)), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * Styles Module for GrapesJS AI Agent Plugin\r\n * Injects all CSS styles into the editor document\r\n */\r\n\r\nexport default (editor, opts = {}) => {\r\n  const pfx = opts.classPrefix || 'gaia';\r\n  \r\n  const css = `\r\n    /* ========================================\r\n       Floating Action Button (FAB)\r\n       ======================================== */\r\n    .${pfx}-fab {\r\n      position: fixed;\r\n      bottom: 20px;\r\n      right: 20px;\r\n      width: 56px;\r\n      height: 56px;\r\n      border-radius: 50%;\r\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\r\n      border: none;\r\n      cursor: pointer;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n      z-index: 15;\r\n      outline: none;\r\n    }\r\n\r\n    .${pfx}-fab:hover {\r\n      transform: scale(1.1);\r\n    }\r\n\r\n    .${pfx}-fab:active {\r\n      transform: scale(0.95);\r\n    }\r\n\r\n    .${pfx}-fab.${pfx}-dragging {\r\n      cursor: grabbing;\r\n      transition: none;\r\n    }\r\n\r\n    .${pfx}-fab svg {\r\n      width: 32px;\r\n      height: 32px;\r\n      stroke: white;\r\n    }\r\n\r\n    /* ========================================\r\n       Chatbot Panel\r\n       ======================================== */\r\n    .${pfx}-panel {\r\n      position: fixed;\r\n      bottom: 90px;\r\n      right: 20px;\r\n      width: ${opts.panelWidth || 360}px;\r\n      height: ${opts.panelHeight || 480}px;\r\n      background: #09090B;\r\n      border-radius: 16px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      z-index: 15;\r\n      overflow: hidden;\r\n      opacity: 0;\r\n      transform: translateY(20px) scale(0.95);\r\n      pointer-events: none;\r\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n    }\r\n\r\n    .${pfx}-panel.${pfx}-open {\r\n      opacity: 1;\r\n      transform: translateY(0) scale(1);\r\n      pointer-events: auto;\r\n    }\r\n\r\n    /* Header */\r\n    .${pfx}-header {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      padding: 8px 8px 8px 16px;\r\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\r\n      color: white;\r\n    }\r\n\r\n    .${pfx}-header-title {\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      margin: 0;\r\n    }\r\n\r\n    .${pfx}-close-btn {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border: none;\r\n      width: 28px;\r\n      height: 28px;\r\n      border-radius: 50%;\r\n      cursor: pointer;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      transition: background 0.2s;\r\n    }\r\n\r\n    .${pfx}-close-btn:hover {\r\n      background: rgba(255, 255, 255, 0.3);\r\n    }\r\n\r\n    .${pfx}-close-btn svg {\r\n      width: 14px;\r\n      height: 14px;\r\n      fill: white;\r\n    }\r\n\r\n    /* Messages Area */\r\n    .${pfx}-messages {\r\n      flex: 1;\r\n      overflow-y: auto;\r\n      padding: 16px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 12px;\r\n    }\r\n\r\n    .${pfx}-messages::-webkit-scrollbar {\r\n      width: 6px;\r\n    }\r\n\r\n    .${pfx}-messages::-webkit-scrollbar-track {\r\n      background: transparent;\r\n    }\r\n\r\n    .${pfx}-messages::-webkit-scrollbar-thumb {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 3px;\r\n    }\r\n\r\n    /* Message Bubbles */\r\n    .${pfx}-message {\r\n      max-width: 85%;\r\n      padding: 12px 16px;\r\n      border-radius: 16px;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n      font-size: 14px;\r\n      line-height: 1.5;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .${pfx}-message-assistant {\r\n      align-self: flex-start;\r\n      background: #ffffff1a;\r\n      color: #e0e0e0;\r\n      border-bottom-left-radius: 4px;\r\n    }\r\n\r\n    .${pfx}-message-user {\r\n      align-self: flex-end;\r\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\r\n      color: white;\r\n      border-bottom-right-radius: 4px;\r\n    }\r\n\r\n    /* Component Badges in Messages */\r\n    .${pfx}-message-badge {\r\n      display: inline-block;\r\n      background: rgba(255, 255, 255, 0.2);\r\n      padding: 2px 8px;\r\n      border-radius: 12px;\r\n      font-size: 12px;\r\n      margin: 2px 4px 2px 0;\r\n      font-family: 'Monaco', 'Menlo', monospace;\r\n    }\r\n\r\n    /* Loading Indicator */\r\n    .${pfx}-loading {\r\n      align-self: flex-start;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n      padding: 12px 16px;\r\n      background: #ffffff1a;\r\n      border-radius: 16px;\r\n      border-bottom-left-radius: 4px;\r\n    }\r\n\r\n    .${pfx}-loading-dots {\r\n      display: flex;\r\n      gap: 4px;\r\n    }\r\n\r\n    .${pfx}-loading-dot {\r\n      width: 8px;\r\n      height: 8px;\r\n      background: #007370;\r\n      border-radius: 50%;\r\n      animation: ${pfx}-bounce 1.4s infinite ease-in-out;\r\n    }\r\n\r\n    .${pfx}-loading-dot:nth-child(1) { animation-delay: -0.32s; }\r\n    .${pfx}-loading-dot:nth-child(2) { animation-delay: -0.16s; }\r\n    .${pfx}-loading-dot:nth-child(3) { animation-delay: 0s; }\r\n\r\n    @keyframes ${pfx}-bounce {\r\n      0%, 80%, 100% { transform: scale(0); }\r\n      40% { transform: scale(1); }\r\n    }\r\n\r\n    /* Badge Area */\r\n    .${pfx}-badges {\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      gap: 6px;\r\n      padding: 8px 12px;\r\n      background: #18181B;\r\n      min-height: 36px;\r\n      border-top: 1px solid #ffffff1a;\r\n    }\r\n\r\n    .${pfx}-badges:empty {\r\n      display: none;\r\n    }\r\n\r\n    .${pfx}-badge {\r\n      display: inline-flex;\r\n      align-items: center;\r\n      gap: 6px;\r\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\r\n      color: white;\r\n      padding: 4px 10px;\r\n      border-radius: 8px;\r\n      font-family: 'Monaco', 'Menlo', monospace;\r\n      font-size: 11px;\r\n    }\r\n\r\n    .${pfx}-badge-remove {\r\n      background: rgba(255, 255, 255, 0.3);\r\n      border: none;\r\n      width: 16px;\r\n      height: 16px;\r\n      border-radius: 50%;\r\n      cursor: pointer;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      padding: 0;\r\n      transition: background 0.2s;\r\n    }\r\n\r\n    .${pfx}-badge-remove:hover {\r\n      background: rgba(255, 255, 255, 0.5);\r\n    }\r\n\r\n    .${pfx}-badge-remove svg {\r\n      width: 8px;\r\n      height: 8px;\r\n      fill: white;\r\n    }\r\n\r\n    /* Input Area */\r\n    .${pfx}-input-area {\r\n      display: flex;\r\n      gap: 8px;\r\n      padding: 12px 12px;\r\n      background: #18181B;\r\n      border-top: 1px solid #ffffff1a;\r\n    }\r\n\r\n    .${pfx}-input {\r\n      flex: 1;\r\n      background: #ffffff1a;\r\n      border: 1px solid #3d3d5c;\r\n      border-radius: 8px;\r\n      padding: 10px 16px;\r\n      color: #e0e0e0;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n      font-size: 14px;\r\n      outline: none;\r\n      transition: border-color 0.2s;\r\n      resize: none;\r\n      min-height: 40px;\r\n      max-height: 100px;\r\n    }\r\n\r\n    .${pfx}-input:focus {\r\n      border-color: #007370;\r\n    }\r\n\r\n    .${pfx}-input::placeholder {\r\n      color: #a3a3a3;\r\n    }\r\n\r\n    .${pfx}-submit-btn {\r\n      width: 40px;\r\n      height: 40px;\r\n      min-width: 40px;\r\n      border-radius: 50%;\r\n      background: linear-gradient(135deg, #007370 0%, #007370 100%);\r\n      border: none;\r\n      cursor: pointer;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      transition: all 0.2s;\r\n    }\r\n\r\n    .${pfx}-submit-btn:hover {\r\n      transform: scale(1.05);\r\n    }\r\n\r\n    .${pfx}-submit-btn:disabled {\r\n      opacity: 0.5;\r\n      cursor: not-allowed;\r\n      transform: none;\r\n    }\r\n\r\n    .${pfx}-submit-btn svg {\r\n      width: 18px;\r\n      height: 18px;\r\n      fill: white;\r\n    }\r\n\r\n    /* Error Message */\r\n    .${pfx}-error {\r\n      background: #ff4757;\r\n      color: white;\r\n      padding: 8px 12px;\r\n      border-radius: 8px;\r\n      font-size: 13px;\r\n      margin: 8px 16px;\r\n    }\r\n\r\n    /* Empty State */\r\n    .${pfx}-empty {\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      justify-content: center;\r\n      height: 100%;\r\n      color: #a3a3a3;\r\n      text-align: center;\r\n      padding: 20px;\r\n    }\r\n\r\n    .${pfx}-empty svg {\r\n      width: 64px;\r\n      height: 64px;\r\n      margin-bottom: 16px;\r\n    }\r\n\r\n    .${pfx}-empty p {\r\n      margin: 0;\r\n      font-size: 14px;\r\n      line-height: 1.5;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n    }\r\n\r\n    /* Toolbar Button */\r\n    .${pfx}-toolbar-btn {\r\n      display: inline-block;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n\r\n    .${pfx}-toolbar-btn svg {\r\n      width: 16px;\r\n      height: 16px;\r\n      fill: none;\r\n    }\r\n  `;\r\n\r\n  // Inject styles into the document\r\n  const injectStyles = () => {\r\n    const styleEl = document.createElement('style');\r\n    styleEl.id = `${pfx}-styles`;\r\n    styleEl.textContent = css;\r\n    document.head.appendChild(styleEl);\r\n  };\r\n\r\n  // Remove existing styles if any (for hot reload)\r\n  const existingStyles = document.getElementById(`${pfx}-styles`);\r\n  if (existingStyles) {\r\n    existingStyles.remove();\r\n  }\r\n\r\n  injectStyles();\r\n\r\n  return { css, pfx };\r\n};\r\n","/**\r\n * Floating Action Button (FAB) Module for GrapesJS AI Agent Plugin\r\n * Creates a draggable FAB that toggles the chatbot panel\r\n */\r\n\r\n// SVG icon for the chat bubble\r\nconst chatIcon = `\r\n  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <g><path d=\"M6 6h12a2.25 2.25 0 012.25 2.25v7.5A2.25 2.25 0 0118 18h-6l-4 3 0-3H6a2.25 2.25 0 01-2.25-2.25v-7.5A2.25 2.25 0 016 6zM12 3v3M9 3h6M8.25 12a.75.75 0 110-1.5.75.75 0 010 1.5zM15.75 12a.75.75 0 110-1.5.75.75 0 010 1.5zM9 15h6\"></path></g>\r\n  </svg>\r\n`;\r\n\r\nexport default (editor, opts = {}, state) => {\r\n  const pfx = opts.classPrefix || 'gaia';\r\n  const storageKey = `${pfx}-fab-position`;\r\n  const DRAG_THRESHOLD = 5;\r\n  \r\n  let fab = null;\r\n  let isDragging = false;\r\n  let hasDragged = false;\r\n  let offsetX = 0;\r\n  let offsetY = 0;\r\n  let startMouseX = 0;\r\n  let startMouseY = 0;\r\n\r\n  /**\r\n   * Creates the FAB element\r\n   */\r\n  const createFAB = () => {\r\n    fab = document.createElement('button');\r\n    fab.className = `${pfx}-fab`;\r\n    fab.innerHTML = chatIcon;\r\n    fab.setAttribute('title', 'AI Assistant');\r\n    fab.setAttribute('aria-label', 'Open AI Assistant');\r\n\r\n    // Apply saved position or use default (bottom-right via CSS)\r\n    const saved = getSavedPosition();\r\n    if (saved) {\r\n      fab.style.left = `${saved.x}px`;\r\n      fab.style.top = `${saved.y}px`;\r\n      fab.style.right = 'auto';\r\n      fab.style.bottom = 'auto';\r\n    }\r\n\r\n    fab.addEventListener('mousedown', handleMouseDown);\r\n    fab.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n\r\n    // Inject into editor container\r\n    const editorEl = editor.getContainer();\r\n    if (editorEl) {\r\n      editorEl.style.position = 'relative';\r\n      editorEl.appendChild(fab);\r\n    } else {\r\n      document.body.appendChild(fab);\r\n    }\r\n\r\n    return fab;\r\n  };\r\n\r\n  /**\r\n   * Get/save position from sessionStorage\r\n   */\r\n  const getSavedPosition = () => {\r\n    try {\r\n      const saved = sessionStorage.getItem(storageKey);\r\n      return saved ? JSON.parse(saved) : null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const savePosition = () => {\r\n    try {\r\n      const rect = fab.getBoundingClientRect();\r\n      sessionStorage.setItem(storageKey, JSON.stringify({ \r\n        x: rect.left, \r\n        y: rect.top \r\n      }));\r\n    } catch (e) {}\r\n  };\r\n\r\n  /**\r\n   * Mouse/touch event handlers\r\n   */\r\n  const handleMouseDown = (e) => {\r\n    if (e.button !== 0) return;\r\n    e.preventDefault();\r\n    startDrag(e.clientX, e.clientY);\r\n    document.addEventListener('mousemove', handleMouseMove);\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n  };\r\n\r\n  const handleTouchStart = (e) => {\r\n    if (e.touches.length !== 1) return;\r\n    e.preventDefault();\r\n    const touch = e.touches[0];\r\n    startDrag(touch.clientX, touch.clientY);\r\n    document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n    document.addEventListener('touchend', handleTouchEnd);\r\n    document.addEventListener('touchcancel', handleTouchEnd);\r\n  };\r\n\r\n  /**\r\n   * Start drag - capture offset of cursor within FAB\r\n   */\r\n  const startDrag = (clientX, clientY) => {\r\n    isDragging = true;\r\n    hasDragged = false;\r\n    startMouseX = clientX;\r\n    startMouseY = clientY;\r\n    \r\n    // Store where on the FAB the user clicked (viewport coords)\r\n    const rect = fab.getBoundingClientRect();\r\n    offsetX = clientX - rect.left;\r\n    offsetY = clientY - rect.top;\r\n  };\r\n\r\n  /**\r\n   * Disable canvas pointer events to prevent GrapesJS from intercepting drag\r\n   */\r\n  const disableCanvasEvents = () => {\r\n    const canvas = editor.Canvas?.getElement();\r\n    const frame = editor.Canvas?.getFrameEl();\r\n    if (canvas) canvas.style.pointerEvents = 'none';\r\n    if (frame) frame.style.pointerEvents = 'none';\r\n  };\r\n\r\n  /**\r\n   * Re-enable canvas pointer events after drag\r\n   */\r\n  const enableCanvasEvents = () => {\r\n    const canvas = editor.Canvas?.getElement();\r\n    const frame = editor.Canvas?.getFrameEl();\r\n    if (canvas) canvas.style.pointerEvents = '';\r\n    if (frame) frame.style.pointerEvents = '';\r\n  };\r\n\r\n  const handleMouseMove = (e) => {\r\n    if (!isDragging) return;\r\n    e.preventDefault();\r\n    updateDrag(e.clientX, e.clientY);\r\n  };\r\n\r\n  const handleTouchMove = (e) => {\r\n    if (!isDragging || e.touches.length !== 1) return;\r\n    e.preventDefault();\r\n    updateDrag(e.touches[0].clientX, e.touches[0].clientY);\r\n  };\r\n\r\n  /**\r\n   * Update position during drag - use viewport coordinates directly\r\n   */\r\n  const updateDrag = (clientX, clientY) => {\r\n    // Check drag threshold\r\n    if (!hasDragged) {\r\n      const dx = clientX - startMouseX;\r\n      const dy = clientY - startMouseY;\r\n      if (Math.sqrt(dx * dx + dy * dy) < DRAG_THRESHOLD) return;\r\n      \r\n      hasDragged = true;\r\n      fab.classList.add(`${pfx}-dragging`);\r\n      \r\n      // Disable canvas events so it doesn't intercept our drag\r\n      disableCanvasEvents();\r\n      \r\n      if (state.isOpen) {\r\n        state.togglePanel();\r\n      }\r\n    }\r\n    \r\n    // Calculate new position in viewport coords\r\n    // Simply: cursor position minus the offset where we grabbed the FAB\r\n    let newX = clientX - offsetX;\r\n    let newY = clientY - offsetY;\r\n    \r\n    // Constrain to viewport\r\n    const fabWidth = fab.offsetWidth;\r\n    const fabHeight = fab.offsetHeight;\r\n    newX = Math.max(0, Math.min(newX, window.innerWidth - fabWidth));\r\n    newY = Math.max(0, Math.min(newY, window.innerHeight - fabHeight));\r\n    \r\n    // Apply position\r\n    fab.style.left = `${newX}px`;\r\n    fab.style.top = `${newY}px`;\r\n    fab.style.right = 'auto';\r\n    fab.style.bottom = 'auto';\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    document.removeEventListener('mousemove', handleMouseMove);\r\n    document.removeEventListener('mouseup', handleMouseUp);\r\n    endDrag();\r\n  };\r\n\r\n  const handleTouchEnd = () => {\r\n    document.removeEventListener('touchmove', handleTouchMove);\r\n    document.removeEventListener('touchend', handleTouchEnd);\r\n    document.removeEventListener('touchcancel', handleTouchEnd);\r\n    endDrag();\r\n  };\r\n\r\n  /**\r\n   * End drag - save position or toggle panel\r\n   */\r\n  const endDrag = () => {\r\n    if (!isDragging) return;\r\n    isDragging = false;\r\n    fab.classList.remove(`${pfx}-dragging`);\r\n    \r\n    // Re-enable canvas events\r\n    enableCanvasEvents();\r\n    \r\n    if (hasDragged) {\r\n      savePosition();\r\n    } else {\r\n      state.togglePanel();\r\n    }\r\n    hasDragged = false;\r\n  };\r\n\r\n  const getFAB = () => fab;\r\n\r\n  const getPosition = () => {\r\n    if (!fab) return { x: 0, y: 0 };\r\n    const rect = fab.getBoundingClientRect();\r\n    return { x: rect.left, y: rect.top };\r\n  };\r\n\r\n  const destroy = () => {\r\n    if (fab) {\r\n      fab.removeEventListener('mousedown', handleMouseDown);\r\n      fab.removeEventListener('touchstart', handleTouchStart);\r\n      fab.remove();\r\n      fab = null;\r\n    }\r\n  };\r\n\r\n  createFAB();\r\n\r\n  return { getFAB, getPosition, destroy };\r\n};\r\n","/**\r\n * Chatbot Panel Module for GrapesJS AI Agent Plugin\r\n * Creates and manages the chatbot interface UI\r\n */\r\n\r\n// SVG icons\r\nconst closeIcon = `\r\n  <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\r\n  </svg>\r\n`;\r\n\r\nconst sendIcon = `\r\n  <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"/>\r\n  </svg>\r\n`;\r\n\r\nconst removeIcon = `\r\n  <svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\r\n  </svg>\r\n`;\r\n\r\nconst emptyIcon = `\r\n  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <g><path d=\"M6 6h12a2.25 2.25 0 012.25 2.25v7.5A2.25 2.25 0 0118 18h-6l-4 3 0-3H6a2.25 2.25 0 01-2.25-2.25v-7.5A2.25 2.25 0 016 6zM12 3v3M9 3h6M8.25 12a.75.75 0 110-1.5.75.75 0 010 1.5zM15.75 12a.75.75 0 110-1.5.75.75 0 010 1.5zM9 15h6\"></path></g>\r\n  </svg>\r\n`;\r\n\r\nexport default (editor, opts = {}, state, fabModule, apiModule) => {\r\n  const pfx = opts.classPrefix || 'gaia';\r\n  \r\n  let panel = null;\r\n  let messagesContainer = null;\r\n  let badgesContainer = null;\r\n  let inputEl = null;\r\n  let submitBtn = null;\r\n\r\n  /**\r\n   * Creates the chatbot panel and injects it into the DOM\r\n   */\r\n  const createPanel = () => {\r\n    panel = document.createElement('div');\r\n    panel.className = `${pfx}-panel`;\r\n\r\n    panel.innerHTML = `\r\n      <div class=\"${pfx}-header\">\r\n        <h3 class=\"${pfx}-header-title\">${opts.chatTitle || 'AI Assistant'}</h3>\r\n        <button class=\"${pfx}-close-btn\" aria-label=\"Close\">${closeIcon}</button>\r\n      </div>\r\n      <div class=\"${pfx}-messages\"></div>\r\n      <div class=\"${pfx}-badges\"></div>\r\n      <div class=\"${pfx}-input-area\">\r\n        <textarea class=\"${pfx}-input\" placeholder=\"${opts.inputPlaceholder || 'Type your message...'}\" rows=\"1\"></textarea>\r\n        <button class=\"${pfx}-submit-btn\" aria-label=\"Submit\">${sendIcon}</button>\r\n      </div>\r\n    `;\r\n\r\n    // Get references to elements\r\n    messagesContainer = panel.querySelector(`.${pfx}-messages`);\r\n    badgesContainer = panel.querySelector(`.${pfx}-badges`);\r\n    inputEl = panel.querySelector(`.${pfx}-input`);\r\n    submitBtn = panel.querySelector(`.${pfx}-submit-btn`);\r\n\r\n    // Attach event listeners\r\n    const closeBtn = panel.querySelector(`.${pfx}-close-btn`);\r\n    closeBtn.addEventListener('click', () => state.togglePanel());\r\n\r\n    submitBtn.addEventListener('click', handleSubmit);\r\n    inputEl.addEventListener('keydown', handleKeyDown);\r\n    inputEl.addEventListener('input', autoResizeInput);\r\n\r\n    // Inject into editor container\r\n    const editorEl = editor.getContainer();\r\n    if (editorEl) {\r\n      editorEl.appendChild(panel);\r\n    } else {\r\n      document.body.appendChild(panel);\r\n    }\r\n\r\n    // Initial render\r\n    renderMessages();\r\n\r\n    return panel;\r\n  };\r\n\r\n  /**\r\n   * Auto-resize textarea based on content\r\n   */\r\n  const autoResizeInput = () => {\r\n    inputEl.style.height = 'auto';\r\n    inputEl.style.height = Math.min(inputEl.scrollHeight, 100) + 'px';\r\n  };\r\n\r\n  /**\r\n   * Handles keyboard events in the input\r\n   */\r\n  const handleKeyDown = (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSubmit();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handles form submission\r\n   */\r\n  const handleSubmit = async () => {\r\n    const message = inputEl.value.trim();\r\n    let components = [...state.pendingComponents];\r\n\r\n    // If no new components selected, use last used components for context continuity\r\n    if (components.length === 0 && state.lastUsedComponents.length > 0) {\r\n      components = [...state.lastUsedComponents];\r\n    }\r\n\r\n    if (!message && components.length === 0) {\r\n      return;\r\n    }\r\n\r\n    // Remember these components for follow-up conversations\r\n    if (components.length > 0) {\r\n      state.lastUsedComponents = [...components];\r\n    }\r\n\r\n    // Add user message to history\r\n    const userMessage = {\r\n      role: 'user',\r\n      content: message,\r\n      components: components.length > 0 ? components : undefined\r\n    };\r\n    state.history.push(userMessage);\r\n\r\n    // Clear input and badges\r\n    inputEl.value = '';\r\n    autoResizeInput();\r\n    state.pendingComponents = [];\r\n    renderBadges();\r\n    renderMessages();\r\n\r\n    // Disable input during submission and show loading indicator\r\n    // (Must be AFTER renderMessages to avoid being cleared)\r\n    setSubmitting(true);\r\n\r\n    // Send to API\r\n    try {\r\n      const response = await apiModule.sendMessage(message, components, state.history);\r\n      \r\n      // Add assistant response to history\r\n      const assistantMessage = {\r\n        role: 'assistant',\r\n        content: response.reply || 'I have processed your request.'\r\n      };\r\n      state.history.push(assistantMessage);\r\n\r\n      // Apply modifications if any\r\n      if (response.modifications) {\r\n        apiModule.applyModifications(response.modifications);\r\n      }\r\n\r\n      renderMessages();\r\n    } catch (error) {\r\n      console.error('API Error:', error);\r\n      \r\n      // Add error message to history\r\n      const errorMessage = {\r\n        role: 'assistant',\r\n        content: `Error: ${error.message || 'Failed to process request. Please try again.'}`,\r\n        isError: true\r\n      };\r\n      state.history.push(errorMessage);\r\n      renderMessages();\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Sets the submitting state (loading)\r\n   */\r\n  const setSubmitting = (isSubmitting) => {\r\n    state.isLoading = isSubmitting;\r\n    submitBtn.disabled = isSubmitting;\r\n    inputEl.disabled = isSubmitting;\r\n\r\n    if (isSubmitting) {\r\n      // Add loading indicator\r\n      const loadingEl = document.createElement('div');\r\n      loadingEl.className = `${pfx}-loading`;\r\n      loadingEl.id = `${pfx}-loading-indicator`;\r\n      loadingEl.innerHTML = `\r\n        <div class=\"${pfx}-loading-dots\">\r\n          <div class=\"${pfx}-loading-dot\"></div>\r\n          <div class=\"${pfx}-loading-dot\"></div>\r\n          <div class=\"${pfx}-loading-dot\"></div>\r\n        </div>\r\n      `;\r\n      messagesContainer.appendChild(loadingEl);\r\n      scrollToBottom();\r\n    } else {\r\n      // Remove loading indicator\r\n      const loadingEl = document.getElementById(`${pfx}-loading-indicator`);\r\n      if (loadingEl) {\r\n        loadingEl.remove();\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Renders all messages in the history\r\n   */\r\n  const renderMessages = () => {\r\n    if (!messagesContainer) return;\r\n\r\n    // Clear container\r\n    messagesContainer.innerHTML = '';\r\n\r\n    if (state.history.length === 0) {\r\n      renderEmptyState();\r\n      return;\r\n    }\r\n\r\n    // Render each message\r\n    state.history.forEach((msg) => {\r\n      const messageEl = document.createElement('div');\r\n      messageEl.className = `${pfx}-message ${pfx}-message-${msg.role}`;\r\n      \r\n      if (msg.isError) {\r\n        messageEl.classList.add(`${pfx}-error`);\r\n      }\r\n\r\n      // Build message content\r\n      let content = escapeHtml(msg.content);\r\n\r\n      // Add component badges if present\r\n      if (msg.components && msg.components.length > 0) {\r\n        const badges = msg.components.map(id => \r\n          `<span class=\"${pfx}-message-badge\">[component: ${escapeHtml(id)}]</span>`\r\n        ).join('');\r\n        content = badges + '<br>' + content;\r\n      }\r\n\r\n      messageEl.innerHTML = content;\r\n      messagesContainer.appendChild(messageEl);\r\n    });\r\n\r\n    scrollToBottom();\r\n  };\r\n\r\n  /**\r\n   * Renders the empty state when no messages\r\n   */\r\n  const renderEmptyState = () => {\r\n    if (state.history.length > 0) return;\r\n\r\n    const emptyEl = document.createElement('div');\r\n    emptyEl.className = `${pfx}-empty`;\r\n    emptyEl.innerHTML = `\r\n      ${emptyIcon}\r\n      <p>${opts.emptyMessage || \"Hello! Select components and describe what changes you'd like me to make.\"}</p>\r\n    `;\r\n    messagesContainer.appendChild(emptyEl);\r\n  };\r\n\r\n  /**\r\n   * Renders the component badges\r\n   */\r\n  const renderBadges = () => {\r\n    if (!badgesContainer) return;\r\n\r\n    badgesContainer.innerHTML = '';\r\n\r\n    state.pendingComponents.forEach((id) => {\r\n      const badge = document.createElement('div');\r\n      badge.className = `${pfx}-badge`;\r\n      badge.innerHTML = `\r\n        <span>[component: ${escapeHtml(id)}]</span>\r\n        <button class=\"${pfx}-badge-remove\" data-id=\"${escapeHtml(id)}\" aria-label=\"Remove\">${removeIcon}</button>\r\n      `;\r\n\r\n      // Add remove handler\r\n      const removeBtn = badge.querySelector(`.${pfx}-badge-remove`);\r\n      removeBtn.addEventListener('click', () => {\r\n        removeComponentBadge(id);\r\n      });\r\n\r\n      badgesContainer.appendChild(badge);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Adds a component badge to the pending list\r\n   */\r\n  const addComponentBadge = (componentId) => {\r\n    if (!state.pendingComponents.includes(componentId)) {\r\n      state.pendingComponents.push(componentId);\r\n      renderBadges();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Removes a component badge from the pending list\r\n   */\r\n  const removeComponentBadge = (componentId) => {\r\n    const index = state.pendingComponents.indexOf(componentId);\r\n    if (index > -1) {\r\n      state.pendingComponents.splice(index, 1);\r\n      renderBadges();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Positions the panel relative to FAB using viewport coordinates\r\n   */\r\n  const updatePanelPosition = () => {\r\n    if (!panel || !fabModule) return;\r\n\r\n    const fab = fabModule.getFAB();\r\n    if (!fab) return;\r\n\r\n    const fabRect = fab.getBoundingClientRect();\r\n    const panelWidth = opts.panelWidth || 360;\r\n    const panelHeight = opts.panelHeight || 480;\r\n    const gap = 10;\r\n\r\n    // Use FAB's viewport position directly\r\n    const fabLeft = fabRect.left;\r\n    const fabTop = fabRect.top;\r\n    const fabRight = fabRect.right;\r\n    const fabBottom = fabRect.bottom;\r\n    const fabCenterX = fabLeft + fabRect.width / 2;\r\n    const fabCenterY = fabTop + fabRect.height / 2;\r\n\r\n    let panelX, panelY;\r\n\r\n    // Determine best horizontal position based on FAB location in viewport\r\n    const spaceRight = window.innerWidth - fabRight;\r\n    const spaceLeft = fabLeft;\r\n\r\n    if (spaceLeft >= panelWidth + gap) {\r\n      // Position to the left of FAB\r\n      panelX = fabLeft - panelWidth - gap;\r\n    } else if (spaceRight >= panelWidth + gap) {\r\n      // Position to the right of FAB\r\n      panelX = fabRight + gap;\r\n    } else {\r\n      // Center horizontally\r\n      panelX = Math.max(gap, (window.innerWidth - panelWidth) / 2);\r\n    }\r\n\r\n    // Determine best vertical position based on FAB location in viewport\r\n    const spaceTop = fabTop;\r\n    const spaceBottom = window.innerHeight - fabBottom;\r\n\r\n    if (spaceTop >= panelHeight + gap) {\r\n      // Position above FAB, align bottom of panel with top of FAB\r\n      panelY = fabTop - panelHeight - gap;\r\n    } else if (spaceBottom >= panelHeight + gap) {\r\n      // Position below FAB\r\n      panelY = fabBottom + gap;\r\n    } else {\r\n      // Align vertically centered with FAB\r\n      panelY = Math.max(gap, fabCenterY - panelHeight / 2);\r\n      panelY = Math.min(panelY, window.innerHeight - panelHeight - gap);\r\n    }\r\n\r\n    // Apply position using viewport coordinates (position: fixed)\r\n    panel.style.position = 'fixed';\r\n    panel.style.right = 'auto';\r\n    panel.style.bottom = 'auto';\r\n    panel.style.left = `${panelX}px`;\r\n    panel.style.top = `${panelY}px`;\r\n  };\r\n\r\n  /**\r\n   * Opens the chatbot panel\r\n   */\r\n  const openPanel = () => {\r\n    if (panel) {\r\n      updatePanelPosition();\r\n      panel.classList.add(`${pfx}-open`);\r\n      inputEl.focus();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Closes the chatbot panel\r\n   */\r\n  const closePanel = () => {\r\n    if (panel) {\r\n      panel.classList.remove(`${pfx}-open`);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Scrolls the messages container to the bottom\r\n   */\r\n  const scrollToBottom = () => {\r\n    if (messagesContainer) {\r\n      messagesContainer.scrollTop = messagesContainer.scrollHeight;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Escapes HTML to prevent XSS\r\n   */\r\n  const escapeHtml = (text) => {\r\n    if (!text) return '';\r\n    const div = document.createElement('div');\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n  };\r\n\r\n  /**\r\n   * Gets the panel element\r\n   */\r\n  const getPanel = () => panel;\r\n\r\n  /**\r\n   * Destroys the chatbot panel\r\n   */\r\n  const destroy = () => {\r\n    if (panel) {\r\n      panel.remove();\r\n      panel = null;\r\n    }\r\n  };\r\n\r\n  // Initialize panel\r\n  createPanel();\r\n\r\n  return {\r\n    getPanel,\r\n    openPanel,\r\n    closePanel,\r\n    addComponentBadge,\r\n    removeComponentBadge,\r\n    renderMessages,\r\n    renderBadges,\r\n    destroy\r\n  };\r\n};\r\n","/**\r\n * Toolbar Module for GrapesJS AI Agent Plugin\r\n * Adds a \"Send to Chat\" button to the component toolbar\r\n */\r\n\r\n// SVG icon for the toolbar button (chat/send icon)\r\nconst toolbarIcon = `\r\n  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <g><path d=\"M6 6h12a2.25 2.25 0 012.25 2.25v7.5A2.25 2.25 0 0118 18h-6l-4 3 0-3H6a2.25 2.25 0 01-2.25-2.25v-7.5A2.25 2.25 0 016 6zM12 3v3M9 3h6M8.25 12a.75.75 0 110-1.5.75.75 0 010 1.5zM15.75 12a.75.75 0 110-1.5.75.75 0 010 1.5zM9 15h6\"></path></g>\r\n  </svg>\r\n`;\r\n\r\nexport default (editor, opts = {}, state, chatbotModule) => {\r\n  const pfx = opts.classPrefix || 'gaia';\r\n  const commandId = `${pfx}:add-to-chat`;\r\n  const toolbarBtnId = `${pfx}-send-to-chat`;\r\n\r\n  /**\r\n   * Registers the command for adding component to chat\r\n   */\r\n  const registerCommand = () => {\r\n    editor.Commands.add(commandId, {\r\n      run(editor) {\r\n        const selected = editor.getSelected();\r\n        if (selected) {\r\n          // Get the component's unique ID\r\n          const componentId = selected.cid || selected.getId();\r\n          \r\n          // Add to chatbot\r\n          if (chatbotModule) {\r\n            chatbotModule.addComponentBadge(componentId);\r\n            \r\n            // Open panel if not already open\r\n            if (!state.isOpen) {\r\n              state.togglePanel();\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Adds the toolbar button to a component\r\n   * @param {Object} component - GrapesJS component\r\n   */\r\n  const addToolbarButton = (component) => {\r\n    if (!component) return;\r\n\r\n    const toolbar = component.get('toolbar') || [];\r\n    \r\n    // Check if button already exists\r\n    const exists = toolbar.some(btn => btn.id === toolbarBtnId);\r\n    if (exists) return;\r\n\r\n    // Add the button\r\n    const newToolbar = [\r\n      ...toolbar,\r\n      {\r\n        id: toolbarBtnId,\r\n        command: commandId,\r\n        attributes: { \r\n          class: `${pfx}-toolbar-btn`,\r\n          title: 'Send to AI Chat' \r\n        },\r\n        label: toolbarIcon\r\n      }\r\n    ];\r\n\r\n    component.set('toolbar', newToolbar);\r\n  };\r\n\r\n  /**\r\n   * Sets up event listeners for component selection\r\n   */\r\n  const setupEventListeners = () => {\r\n    // Add toolbar button when component is selected\r\n    editor.on('component:selected', (component) => {\r\n      addToolbarButton(component);\r\n    });\r\n\r\n    // Also handle when switching between components\r\n    editor.on('component:toggled', (component) => {\r\n      if (component) {\r\n        addToolbarButton(component);\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Initializes the toolbar integration\r\n   */\r\n  const init = () => {\r\n    registerCommand();\r\n    setupEventListeners();\r\n  };\r\n\r\n  // Initialize\r\n  init();\r\n\r\n  return {\r\n    addToolbarButton,\r\n    commandId,\r\n    toolbarBtnId\r\n  };\r\n};\r\n","/**\n * English locale strings for GrapesJS AI Agent Plugin\n */\nexport default {\n  'grapesjs-ai-agent': {\n    // Chatbot UI\n    'chatTitle': 'AI Assistant',\n    'inputPlaceholder': 'Type your message...',\n    'submitButton': 'Submit',\n    'closeButton': 'Close',\n    \n    // Toolbar\n    'toolbarButton': 'Send to AI Chat',\n    \n    // States\n    'loading': 'Thinking...',\n    'emptyMessage': \"Hello! Select components and describe what changes you'd like me to make.\",\n    \n    // Errors\n    'errorNetwork': 'Network error. Please check your connection and try again.',\n    'errorApi': 'API error. Please try again.',\n    'errorNoApi': 'API endpoint not configured.',\n    'errorNotFound': 'Component not found.',\n    \n    // Success messages\n    'successUpdate': 'Successfully updated the component.',\n    'successMultiUpdate': 'Successfully updated {count} component(s).',\n    \n    // Badges\n    'componentBadge': '[component: {id}]',\n    'removeBadge': 'Remove component',\n  },\n};","/**\n * GrapesJS AI Agent Plugin\n * \n * A plugin that adds an AI-powered chatbot interface to GrapesJS editor.\n * Features:\n * - Draggable Floating Action Button (FAB)\n * - Chatbot panel with message history\n * - Component selection integration\n * - API communication for AI-assisted modifications\n * \n * @author a-hakim\n * @license MIT\n */\n\nimport loadStyles from './styles';\nimport loadFAB from './fab';\nimport loadChatbot from './chatbot';\nimport loadAPI from './api';\nimport loadToolbar from './toolbar';\nimport en from './locale/en';\n\n/**\n * Plugin default options\n */\nconst defaults = {\n  // Required: API endpoint for chatbot requests\n  api: '',\n  \n  // Optional: Custom headers for API requests (e.g. for authentication)\n  headers: {},\n  \n  // Optional: Starting FAB position { x: number, y: number }\n  fabPosition: { x: null, y: null },\n  \n  // Optional: Chatbot panel width in pixels\n  panelWidth: 360,\n  \n  // Optional: Chatbot panel height in pixels\n  panelHeight: 480,\n  \n  // Optional: CSS class prefix to avoid conflicts\n  classPrefix: 'gaia',\n  \n  // Optional: Custom chat title\n  chatTitle: 'AI Assistant',\n  \n  // Optional: Custom input placeholder\n  inputPlaceholder: 'Type your message...',\n  \n  // Optional: Custom empty state message\n  emptyMessage: \"Hello! Select components and describe what changes you'd like me to make.\",\n  \n  // Optional: i18n overrides\n  i18n: {}\n};\n\n/**\n * Main plugin export\n * @param {Object} editor - GrapesJS editor instance\n * @param {Object} opts - Plugin options\n */\nexport default (editor, opts = {}) => {\n  // Merge options with defaults\n  const options = { ...defaults, ...opts };\n\n  // Validate required options\n  if (!options.api) {\n    console.warn('grapesjs-ai-agent: \"api\" option is required but not provided. The plugin will load but API calls will fail.');\n  }\n\n  /**\n   * Shared state object for all modules\n   */\n  const state = {\n    // Chat message history\n    history: [],\n    \n    // Component IDs pending submission\n    pendingComponents: [],\n    \n    // Last used component IDs (for follow-up conversations)\n    lastUsedComponents: [],\n    \n    // Whether the chatbot panel is open\n    isOpen: false,\n    \n    // Whether an API request is in progress\n    isLoading: false,\n    \n    // Toggle panel visibility\n    togglePanel: null // Will be set after chatbot module loads\n  };\n\n  // Module references\n  let fabModule = null;\n  let chatbotModule = null;\n  let apiModule = null;\n  let toolbarModule = null;\n\n  /**\n   * Initialize all modules when editor loads\n   */\n  const initModules = () => {\n    // Load styles\n    loadStyles(editor, options);\n\n    // Load API module (no DOM dependencies)\n    apiModule = loadAPI(editor, options);\n\n    // Create toggle function\n    state.togglePanel = () => {\n      state.isOpen = !state.isOpen;\n      if (state.isOpen) {\n        chatbotModule?.openPanel();\n      } else {\n        chatbotModule?.closePanel();\n      }\n    };\n\n    // Load FAB\n    fabModule = loadFAB(editor, options, state);\n\n    // Load Chatbot\n    chatbotModule = loadChatbot(editor, options, state, fabModule, apiModule);\n\n    // Load Toolbar integration\n    toolbarModule = loadToolbar(editor, options, state, chatbotModule);\n  };\n\n  /**\n   * Load i18n messages\n   */\n  const loadI18n = () => {\n    if (editor.I18n) {\n      editor.I18n.addMessages({\n        en,\n        ...options.i18n,\n      });\n    }\n  };\n\n  /**\n   * Cleanup function for when editor is destroyed\n   */\n  const destroy = () => {\n    fabModule?.destroy();\n    chatbotModule?.destroy();\n  };\n\n  // Initialize when editor is ready\n  editor.on('load', () => {\n    initModules();\n    loadI18n();\n  });\n\n  // Cleanup when editor is destroyed\n  editor.on('destroy', () => {\n    destroy();\n  });\n\n  /**\n   * Public API exposed by the plugin\n   * Accessible via editor.AiAgent\n   */\n  editor.AiAgent = {\n    /**\n     * Opens the chatbot panel\n     */\n    open: () => {\n      if (!state.isOpen) {\n        state.togglePanel();\n      }\n    },\n\n    /**\n     * Closes the chatbot panel\n     */\n    close: () => {\n      if (state.isOpen) {\n        state.togglePanel();\n      }\n    },\n\n    /**\n     * Toggles the chatbot panel\n     */\n    toggle: () => {\n      state.togglePanel();\n    },\n\n    /**\n     * Adds a component ID to the chat input as a badge\n     * @param {string} componentId - The component ID to add\n     */\n    addComponent: (componentId) => {\n      chatbotModule?.addComponentBadge(componentId);\n    },\n\n    /**\n     * Removes a component ID from the chat input\n     * @param {string} componentId - The component ID to remove\n     */\n    removeComponent: (componentId) => {\n      chatbotModule?.removeComponentBadge(componentId);\n    },\n\n    /**\n     * Gets the current chat history\n     * @returns {Object[]} Array of message objects\n     */\n    getHistory: () => {\n      return [...state.history];\n    },\n\n    /**\n     * Clears the chat history\n     */\n    clearHistory: () => {\n      state.history = [];\n      chatbotModule?.renderMessages();\n    },\n\n    /**\n     * Gets the pending component IDs\n     * @returns {string[]} Array of component IDs\n     */\n    getPendingComponents: () => {\n      return [...state.pendingComponents];\n    },\n\n    /**\n     * Checks if the panel is currently open\n     * @returns {boolean}\n     */\n    isOpen: () => state.isOpen,\n\n    /**\n     * Gets the API module for direct access\n     * @returns {Object} API module\n     */\n    api: () => apiModule\n  };\n};","/**\r\n * API Module for GrapesJS AI Agent Plugin\r\n * Handles communication with the AI backend and applies HTML modifications\r\n */\r\n\r\nexport default (editor, opts = {}) => {\r\n  const apiEndpoint = opts.api || '';\r\n  const customHeaders = opts.headers || {};\r\n\r\n  /**\r\n   * Sends a message to the AI API\r\n   * @param {string} message - The user's message\r\n   * @param {string[]} componentIds - Array of selected component IDs\r\n   * @param {Object[]} history - Conversation history\r\n   * @returns {Promise<Object>} - API response with reply and modifications\r\n   */\r\n  const sendMessage = async (message, componentIds = [], history = []) => {\r\n    if (!apiEndpoint) {\r\n      throw new Error('API endpoint not configured. Please set the \"api\" option.');\r\n    }\r\n\r\n    // Gather component data for context\r\n    const componentData = {};\r\n    componentIds.forEach((id) => {\r\n      const component = findComponentById(id);\r\n      if (component) {\r\n        componentData[id] = component.toHTML();\r\n      }\r\n    });\r\n\r\n    // Build request payload\r\n    const payload = {\r\n      history: history.map((msg) => ({\r\n        role: msg.role,\r\n        content: msg.content,\r\n        components: msg.components || []\r\n      })),\r\n      message: message,\r\n      components: componentIds,\r\n      componentData: componentData\r\n    };\r\n\r\n    try {\r\n      const response = await fetch(apiEndpoint, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Accept': 'application/json',\r\n          ...customHeaders\r\n        },\r\n        body: JSON.stringify(payload)\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw new Error(`API error (${response.status}): ${errorText || 'Unknown error'}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      if (error.name === 'TypeError' && error.message.includes('fetch')) {\r\n        throw new Error('Network error. Please check your connection and try again.');\r\n      }\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Finds a component by its ID (cid) in the editor\r\n   * @param {string} id - Component ID\r\n   * @returns {Object|null} - GrapesJS component or null\r\n   */\r\n  const findComponentById = (id) => {\r\n    const wrapper = editor.getWrapper();\r\n    if (!wrapper) return null;\r\n\r\n    // Search recursively through all components\r\n    const findInComponents = (components) => {\r\n      for (const component of components.models || []) {\r\n        if (component.cid === id || component.getId() === id) {\r\n          return component;\r\n        }\r\n        // Search in children\r\n        const found = findInComponents(component.components());\r\n        if (found) return found;\r\n      }\r\n      return null;\r\n    };\r\n\r\n    // Check wrapper itself\r\n    if (wrapper.cid === id || wrapper.getId() === id) {\r\n      return wrapper;\r\n    }\r\n\r\n    return findInComponents(wrapper.components());\r\n  };\r\n\r\n  /**\r\n   * Applies HTML modifications to components\r\n   * @param {Object} modifications - Map of component IDs to new HTML\r\n   */\r\n  const applyModifications = (modifications) => {\r\n    const results = {\r\n      success: [],\r\n      failed: []\r\n    };\r\n\r\n    Object.entries(modifications).forEach(([id, newHtml]) => {\r\n      try {\r\n        const component = findComponentById(id);\r\n        \r\n        if (!component) {\r\n          console.warn(`Component with ID \"${id}\" not found`);\r\n          results.failed.push({ id, error: 'Component not found' });\r\n          return;\r\n        }\r\n\r\n        // Preserve component type and basic attributes\r\n        const componentType = component.get('type');\r\n        const attributes = component.getAttributes();\r\n        const classes = component.getClasses();\r\n\r\n        // Clear existing children and replace with new content\r\n        component.components().reset();\r\n\r\n        // Parse new HTML and determine how to apply it\r\n        if (newHtml.trim()) {\r\n          // Check if the new HTML is a full element replacement or just inner content\r\n          const tempDiv = document.createElement('div');\r\n          tempDiv.innerHTML = newHtml.trim();\r\n\r\n          const firstChild = tempDiv.firstElementChild;\r\n          \r\n          if (firstChild && tempDiv.children.length === 1 && \r\n              firstChild.tagName.toLowerCase() === component.get('tagName')?.toLowerCase()) {\r\n            // Full element replacement - merge attributes and use inner content\r\n            const newAttrs = {};\r\n            Array.from(firstChild.attributes).forEach((attr) => {\r\n              if (attr.name !== 'id') { // Preserve original ID\r\n                newAttrs[attr.name] = attr.value;\r\n              }\r\n            });\r\n            \r\n            // Merge attributes (new ones take precedence, but keep original ID)\r\n            component.setAttributes({ ...attributes, ...newAttrs, id: attributes.id });\r\n            \r\n            // Set inner content\r\n            component.components(firstChild.innerHTML);\r\n          } else {\r\n            // Inner content only\r\n            component.components(newHtml);\r\n          }\r\n        }\r\n\r\n        // Restore classes if they were removed\r\n        // if (classes.length > 0) {\r\n        //   const currentClasses = component.getClasses();\r\n        //   classes.forEach((cls) => {\r\n        //     if (!currentClasses.includes(cls)) {\r\n        //       component.addClass(cls);\r\n        //     }\r\n        //   });\r\n        // }\r\n\r\n        // Trigger re-render\r\n        if (component.view) {\r\n          component.view.render();\r\n        }\r\n\r\n        // Trigger change event for undo stack\r\n        component.trigger('change');\r\n\r\n        results.success.push({ id, component });\r\n        console.log(`Successfully updated component \"${id}\"`);\r\n\r\n      } catch (error) {\r\n        console.error(`Failed to update component \"${id}\":`, error);\r\n        results.failed.push({ id, error: error.message });\r\n      }\r\n    });\r\n\r\n    // Log summary\r\n    if (results.success.length > 0) {\r\n      console.log(`Updated ${results.success.length} component(s)`);\r\n    }\r\n    if (results.failed.length > 0) {\r\n      console.warn(`Failed to update ${results.failed.length} component(s)`);\r\n    }\r\n\r\n    // Trigger canvas refresh\r\n    editor.refresh();\r\n\r\n    return results;\r\n  };\r\n\r\n  /**\r\n   * Gets the HTML content of a component by ID\r\n   * @param {string} id - Component ID\r\n   * @returns {string|null} - HTML content or null\r\n   */\r\n  const getComponentHtml = (id) => {\r\n    const component = findComponentById(id);\r\n    return component ? component.toHTML() : null;\r\n  };\r\n\r\n  return {\r\n    sendMessage,\r\n    findComponentById,\r\n    applyModifications,\r\n    getComponentHtml\r\n  };\r\n};\r\n"],"names":["root","factory","exports","module","define","amd","Object","globalThis","window","this","__webpack_require__","definition","key","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","chatIcon","editor","state","arguments","length","undefined","pfx","classPrefix","storageKey","DRAG_THRESHOLD","fab","isDragging","hasDragged","offsetX","offsetY","startMouseX","startMouseY","getSavedPosition","saved","sessionStorage","getItem","JSON","parse","e","handleMouseDown","button","preventDefault","startDrag","clientX","clientY","document","addEventListener","handleMouseMove","handleMouseUp","handleTouchStart","touches","touch","handleTouchMove","passive","handleTouchEnd","rect","getBoundingClientRect","left","top","updateDrag","dx","dy","Math","sqrt","classList","add","disableCanvasEvents","canvas","Canvas","getElement","frame","getFrameEl","style","pointerEvents","isOpen","togglePanel","newX","newY","fabWidth","offsetWidth","fabHeight","offsetHeight","max","min","innerWidth","innerHeight","right","bottom","removeEventListener","endDrag","remove","enableCanvasEvents","savePosition","setItem","stringify","x","y","createFAB","createElement","className","innerHTML","setAttribute","editorEl","getContainer","position","appendChild","body","getFAB","getPosition","destroy","closeIcon","sendIcon","removeIcon","emptyIcon","opts","fabModule","apiModule","panel","messagesContainer","badgesContainer","inputEl","submitBtn","autoResizeInput","height","scrollHeight","handleKeyDown","shiftKey","handleSubmit","async","message","trim","components","pendingComponents","lastUsedComponents","userMessage","role","content","history","push","renderBadges","renderMessages","setSubmitting","response","sendMessage","assistantMessage","reply","modifications","applyModifications","error","console","errorMessage","isError","isSubmitting","isLoading","disabled","loadingEl","id","scrollToBottom","getElementById","forEach","msg","messageEl","escapeHtml","map","join","renderEmptyState","emptyEl","emptyMessage","badge","querySelector","removeComponentBadge","componentId","index","indexOf","splice","scrollTop","text","div","textContent","createPanel","chatTitle","inputPlaceholder","getPanel","openPanel","updatePanelPosition","fabRect","panelWidth","panelHeight","gap","fabLeft","fabTop","fabRight","fabBottom","fabCenterY","width","panelX","panelY","spaceRight","spaceTop","spaceBottom","focus","closePanel","addComponentBadge","includes","toolbarIcon","chatbotModule","commandId","toolbarBtnId","addToolbarButton","component","toolbar","some","btn","newToolbar","command","attributes","class","title","label","set","Commands","run","selected","getSelected","cid","getId","on","defaults","api","headers","fabPosition","i18n","options","warn","toolbarModule","initModules","css","existingStyles","injectStyles","styleEl","head","loadStyles","apiEndpoint","customHeaders","findComponentById","wrapper","getWrapper","findInComponents","models","found","componentIds","Error","componentData","toHTML","payload","fetch","method","ok","errorText","status","json","name","results","success","failed","entries","_ref","newHtml","getAttributes","getClasses","reset","tempDiv","firstChild","firstElementChild","children","tagName","toLowerCase","newAttrs","Array","from","attr","setAttributes","view","render","trigger","log","refresh","getComponentHtml","loadAPI","loadFAB","loadChatbot","loadToolbar","I18n","addMessages","en","AiAgent","open","close","toggle","addComponent","removeComponent","getHistory","clearHistory","getPendingComponents"],"ignoreList":[],"sourceRoot":""}